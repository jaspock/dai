<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Búsqueda de productos</title>
</head>
<body>
  <h2>Búsqueda de productos</h2>
  <form method="get" action="/search">
    <label>Producto:</label>
    <!-- <<< <input type="text" name="q" placeholder="pon aquí el nombre del producto" autofocus required> -->
    <!-- <<< <input type="submit" value="Busca" id="search"> -->
    <!-- >>> -->
    <input type="text" id="q" placeholder="pon aquí el nombre del producto" autofocus required>
    <input type="button" value="Busca" id="search">
    <!-- >>> -->
  </form>

<!-- >>> -->
  <div id="results"></div>

<script>
 function doRequest () {
  var client = new XMLHttpRequest();
  var url= "search?q="+document.querySelector("#q").value;
  client.open("GET", url, true);
  client.onreadystatechange = function () {
    console.log(client.readyState);
    if (client.readyState == 4) {
        if (client.status != 200)
          console.error("The request was not completed successfully (" + client.status + ")!");
        else {
          var r= JSON.parse(client.responseText);
          console.log("Respuesta del servidor: "+client.responseText);
          var output;
          if ("error" in r) {
            output= r.error;
          } else {
            output= "<ul>";
            for (var i=0; i < r.result.length; i++) {
              output+= "<li>"+r.result[i].product+":"+r.result[i].quantity+"</li>";
            }
            output+="</ul>";
          }
          document.querySelector("#results").innerHTML= output;
        }
    }
  };
  client.send(null);
 }

 window.onload= function () {
   document.querySelector("#search").addEventListener("click",doRequest,false);
 }
</script>
<!-- >>> -->

</body>
</html>
